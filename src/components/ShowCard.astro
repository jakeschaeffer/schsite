---
import { getPosterUrl, getYear } from "@/lib/tmdb";
import type { Rating } from "@/data/watch-history";

interface Props {
	name: string;
	posterPath: string | null;
	firstAirDate: string;
	notes: string;
	rating?: Rating | undefined;
}

const { name, posterPath, firstAirDate, notes, rating } = Astro.props;
const posterUrl = getPosterUrl(posterPath);
const year = getYear(firstAirDate);
---

<div
	class="group relative flex flex-col overflow-hidden rounded-lg border border-gray-200 bg-white shadow-sm transition-all hover:shadow-md dark:border-gray-700 dark:bg-gray-800"
>
	<div class="aspect-[2/3] overflow-hidden bg-gray-100 dark:bg-gray-700">
		{
			posterUrl ? (
				<img
					src={posterUrl}
					alt={`${name} poster`}
					class="h-full w-full object-cover transition-transform duration-300 group-hover:scale-105"
					loading="lazy"
				/>
			) : (
				<div class="flex h-full w-full items-center justify-center text-gray-400 dark:text-gray-500">
					<svg class="h-16 w-16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path
							stroke-linecap="round"
							stroke-linejoin="round"
							stroke-width="2"
							d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
						></path>
					</svg>
				</div>
			)
		}
	</div>

	<div class="flex flex-1 flex-col p-4">
		<div class="mb-2 flex min-h-[3rem] items-start justify-between gap-2">
			<h3 class="line-clamp-2 font-semibold text-gray-900 dark:text-gray-100">
				{name}
			</h3>
			{
				rating && (
					<div class="flex-shrink-0">
						{rating === "up" && (
							<svg
								class="h-5 w-5 text-green-600 dark:text-green-400"
								fill="currentColor"
								viewBox="0 0 20 20"
							>
								<path d="M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333v5.43a2 2 0 001.106 1.79l.05.025A4 4 0 008.943 18h5.416a2 2 0 001.962-1.608l1.2-6A2 2 0 0015.56 8H12V4a2 2 0 00-2-2 1 1 0 00-1 1v.667a4 4 0 01-.8 2.4L6.8 7.933a4 4 0 00-.8 2.4z" />
							</svg>
						)}
						{rating === "down" && (
							<svg
								class="h-5 w-5 text-red-600 dark:text-red-400"
								fill="currentColor"
								viewBox="0 0 20 20"
							>
								<path d="M18 9.5a1.5 1.5 0 11-3 0v-6a1.5 1.5 0 013 0v6zM14 9.667v-5.43a2 2 0 00-1.105-1.79l-.05-.025A4 4 0 0011.055 2H5.64a2 2 0 00-1.962 1.608l-1.2 6A2 2 0 004.44 12H8v4a2 2 0 002 2 1 1 0 001-1v-.667a4 4 0 01.8-2.4l1.4-1.866a4 4 0 00.8-2.4z" />
							</svg>
						)}
						{rating === "meh" && (
							<svg
								class="h-5 w-5 text-yellow-600 dark:text-yellow-400"
								fill="currentColor"
								viewBox="0 0 20 20"
							>
								<path d="M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 100-2 1 1 0 000 2zm7-1a1 1 0 11-2 0 1 1 0 012 0zm-.464 5.535a1 1 0 10-1.415-1.414 3 3 0 01-4.242 0 1 1 0 00-1.415 1.414 5 5 0 007.072 0z" />
							</svg>
						)}
					</div>
				)
			}
		</div>

		<div class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400">
			<span>{year}</span>
			{
				notes && (
					<>
						<span>â€¢</span>
						<span class="italic">{notes}</span>
					</>
				)
			}
		</div>
	</div>
</div>
