---
import { formatRating, getPosterUrl, getYear } from "@/lib/tmdb";

interface Props {
	name: string;
	posterPath: string | null;
	firstAirDate: string;
	rating: number;
	overview: string;
	numberOfSeasons: number;
	numberOfEpisodes: number;
}

const { name, posterPath, firstAirDate, rating, overview, numberOfSeasons, numberOfEpisodes } =
	Astro.props;
const posterUrl = getPosterUrl(posterPath);
const year = getYear(firstAirDate);
const formattedRating = formatRating(rating);
---

<div
	class="group relative flex flex-col overflow-hidden rounded-lg border border-gray-200 bg-white shadow-sm transition-all hover:shadow-md dark:border-gray-700 dark:bg-gray-800"
>
	<div class="aspect-[2/3] overflow-hidden bg-gray-100 dark:bg-gray-700">
		{
			posterUrl ? (
				<img
					src={posterUrl}
					alt={`${name} poster`}
					class="h-full w-full object-cover transition-transform duration-300 group-hover:scale-105"
					loading="lazy"
				/>
			) : (
				<div class="flex h-full w-full items-center justify-center text-gray-400 dark:text-gray-500">
					<svg class="h-16 w-16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path
							stroke-linecap="round"
							stroke-linejoin="round"
							stroke-width="2"
							d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
						/>
					</svg>
				</div>
			)
		}
	</div>

	<div class="flex flex-1 flex-col p-4">
		<h3 class="mb-1 line-clamp-2 font-semibold text-gray-900 dark:text-gray-100">
			{name}
		</h3>

		<div class="mb-2 flex items-center gap-3 text-sm text-gray-600 dark:text-gray-400">
			<span>{year}</span>
			<span class="flex items-center gap-1">
				<svg class="h-4 w-4 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
					<path
						d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
					></path>
				</svg>
				<span class="font-medium">{formattedRating}</span>
			</span>
		</div>

		<div class="mb-2 text-xs text-gray-500 dark:text-gray-400">
			{numberOfSeasons} {numberOfSeasons === 1 ? "Season" : "Seasons"} â€¢ {numberOfEpisodes}{" "}
			{numberOfEpisodes === 1 ? "Episode" : "Episodes"}
		</div>

		<p class="line-clamp-3 text-sm text-gray-700 dark:text-gray-300">
			{overview}
		</p>
	</div>
</div>
